---
- name: glance | service | is installed
  sudo: yes
  yum: name=openstack-glance state=installed

- name: glance | service | is configured
  sudo: yes
  template: src=glance.conf.j2 dest="{{ glance_conf_temp }}"
  when: nodes.controller.storage_image.config.glance is defined

- name: glance | crudini | merge config files
  sudo: yes
  shell: crudini --merge {{ glance_conf }} < {{ glance_conf_temp }}
  when: nodes.controller.storage_image.config.glance is defined

- name: nova | service | is configured
  sudo: yes
  template: src=nova.conf.j2 dest="{{ nova_conf_temp }}"
  when: nodes.controller.storage_image.config.nova is defined

- name: nova | crudini | merge config files
  sudo: yes
  shell: crudini --merge {{ nova_conf }} < {{ nova_conf_temp }}
  when: nodes.controller.storage_image.config.nova is defined

- name: cinder | service | is configured
  sudo: yes
  template: src=cinder.conf.j2 dest={{ cinder_conf_temp }}
  when: nodes.controller.storage_image.config.cinder is defined

- name: cinder | crudini | merge config files
  sudo: yes
  shell: crudini --merge {{ cinder_conf }} < {{ cinder_conf_temp }}
  when: nodes.controller.storage_image.config.cinder is defined

- name: glance | service | restart
  sudo: yes
  shell: openstack-service restart glance
  when: nodes.controller.storage_image.config.glance is defined

- name: nova | service | restart
  sudo: yes
  shell: openstack-service restart nova
  when: nodes.controller.storage_image.config.nova is defined

- name: cinder | service | restart
  sudo: yes
  shell: openstack-service restart cinder
  when: nodes.controller.storage_image.config.cinder is defined
